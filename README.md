# smarthome

Workflow to auto close a light after it opens and to keep openning a light when a new motion sensor reading is received

[{"id":"96222a5f.e855c8","type":"function","z":"de691561.195f98","name":"checkIfOn","func":"if(msg.payload == \"ON\") {\nreturn msg;\n}","outputs":1,"noerr":0,"x":260,"y":380,"wires":[["6c690248.92d6cc"]]},{"id":"646f6af0.054f64","type":"mqtt in","z":"de691561.195f98","name":"","topic":"stat/smalltoiletlight/POWER","qos":"2","broker":"4e77d4c3.519d7c","x":140,"y":280,"wires":[["96222a5f.e855c8"]]},{"id":"a5e634af.b033f8","type":"debug","z":"de691561.195f98","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":810,"y":160,"wires":[]},{"id":"fe8df99a.956f48","type":"mqtt in","z":"de691561.195f98","name":"rfBridge","topic":"tele/rfbridge/RESULT","qos":"2","broker":"4e77d4c3.519d7c","x":273.8999710083008,"y":117.60001373291016,"wires":[["1093fb9.f517d04","6c690248.92d6cc"]]},{"id":"b11b43d5.302b9","type":"mqtt out","z":"de691561.195f98","name":"","topic":"cmnd/smalltoiletlight/POWER","qos":"","retain":"","broker":"4e77d4c3.519d7c","x":840,"y":280,"wires":[]},{"id":"6c690248.92d6cc","type":"trigger","z":"de691561.195f98","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"1","bytopic":"all","name":"Switch off delay","x":460,"y":360,"wires":[["b11b43d5.302b9","a5e634af.b033f8"]]},{"id":"1093fb9.f517d04","type":"function","z":"de691561.195f98","name":"checkMotion","func":"var message = JSON.parse(msg.payload);\nif(message.RfReceived.Data == \"CODEOFYOURSENSOR\"){\n    //msg.payload = context.state;\n    msg.payload = 1\n}\nreturn msg;","outputs":1,"noerr":0,"x":455.9999694824219,"y":188.4000244140625,"wires":[["a5e634af.b033f8","b11b43d5.302b9","6c690248.92d6cc"]]},{"id":"4e77d4c3.519d7c","type":"mqtt-broker","z":"","name":"","broker":"mqtt.internetoflego.com","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""}]
